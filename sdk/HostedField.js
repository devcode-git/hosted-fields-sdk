"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.hostedFieldSdk=void 0;var _extends2=require("babel-runtime/helpers/extends"),_extends3=_interopRequireDefault(_extends2),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_actions=require("../actions"),HostedFieldSdk=function(){function e(){_classCallCheck3["default"](this,e),this.window=document.parentWindow||document.defaultView,this.targets=[],this.responses=[]}return _createClass3["default"](e,[{key:"setup",value:function(e){this.merchantId=e.merchantId,this.hostedfieldsurl=e.hostedfieldsurl,this.fields=e.fields,this.service=e.service,this.styles=e.styles,this.callback=e.callback,this.el=e.el,this.initIframes()}},{key:"get",value:function(){var e=this;this.targets.forEach(function(t){t.target.postMessage({action:_actions.actions.get,merchantId:e.merchantId,id:t.id},"*")})}},{key:"initIframes",value:function(){var e=this;this.targets=this.targets.concat(this.fields.map(function(t){return e.initIframe(t)}))}},{key:"eventHandler",value:function(e){var t=e.data,s=t.action,i=t.id,a=t.formData;switch(s){case _actions.actions.formData:this.responses.push({id:i,data:a}),this.sendCallback();break;case _actions.actions.formSubmit:this.pay()}}},{key:"sendCallback",value:function(){var e=this.responses.map(function(e){return e.id}),t=this.targets.map(function(e){return e.id});if(e.length===t.length){var s=!0;if(t.forEach(function(t){s=e.includes(t)}),s){var i=this.responses.reduce(function(e,t){return e=_extends3["default"]({},e,t.data)},{});responses=[],this.callback()(i)}}}},{key:"initIframe",value:function(e){var t=document.createElement("iframe");t.id="iframe-hosted-field-"+e.id,t.name="iframe-hosted-field-"+e.id,t.src=hostedfieldsurl+"?mid="+merchantId;var s=document.querySelector(el),i=document.createElement("div");i.id="hosted-field-"+e.id,i.className="hosted-field",i.appendChild(t),s.appendChild(i);var a=document.querySelector("#"+t.id).contentWindow;return t.onload=this.createIframeProxy.bind(this,e,a),{id:t.id,target:a}}},{key:"createIframeProxy",value:function(e,t){var s={};s[e.name]=e,this.window.addEventListener("message",eventHandler,!1),t.postMessage({action:_actions.actions.setupContent,styles:styles,fields:s,service:this.service},"*")}}]),e}(),hostedFieldSdk=exports.hostedFieldSdk=new HostedFieldSdk;