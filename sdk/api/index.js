"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function setup(e){merchantId=e.merchantId,hostedfieldsurl=e.hostedfieldsurl,fields=e.fields,service=e.service,styles=e.styles,callback=e.callback,el=e.el,initIframes()}function get(){targets.forEach(function(e){e.target.postMessage({action:_actions.actions.get,merchantId:merchantId,id:e.id},"*")})}function initIframes(){targets=targets.concat(fields.map(function(e){return initIframe(e)}))}function eventHandler(e){switch(e.data.action){case _actions.actions.formData:responses.push({id:e.data.id,data:e.data.formData}),sendCallback();break;case _actions.actions.formSubmit:get()}}function sendCallback(){var e=responses.map(function(e){return e.id}),t=targets.map(function(e){return e.id});if(e.length===t.length){var n=!0;if(t.forEach(function(t){n=e.includes(t)}),n){var s=responses.reduce(function(e,t){return e=_extends3["default"]({},e,t.data)},{});responses=[],callback(s)}}}function initIframe(e){var t=document.createElement("iframe");t.id="hosted-field-"+e.id,t.name="hosted-field-"+e.id,t.src=hostedfieldsurl+"?mid="+merchantId;var n=document.querySelector(el),s=document.createElement("div");s.id="hosted-field-container-"+e.id,s.className="hosted-field-container",s.appendChild(t),n.appendChild(s);var a=document.querySelector("#"+t.id).contentWindow;return t.onload=createIframeProxy.bind(this,e,a),{id:t.id,target:a}}function createIframeProxy(e,t){var n={};n[e.name]=e,window.addEventListener("message",eventHandler,!1),t.postMessage({action:_actions.actions.setupContent,styles:styles,fields:n,service:service},"*")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.HostedFields=void 0;var _extends2=require("babel-runtime/helpers/extends"),_extends3=_interopRequireDefault(_extends2),_jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_actions=require("./actions"),merchantId,fields,hostedfieldsurl,service,styles,targets=[],responses=[],el,callback,window=document.parentWindow||document.defaultView,HostedFields=exports.HostedFields={setup:setup,get:get};